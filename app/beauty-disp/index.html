<!doctype html><html lang=zh class=is-dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=content-language content="zh-tw"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta property="og:type" content="website"><meta property="og:url" content="https://uwu.alpaca.tw/app/beauty-disp/"><meta name=referrer content="no-referrer"><title>Beauty Disp 表特爬蟲 | AlpacaUwU 羊駝屋</title>
<meta name=title content="Beauty Disp 表特爬蟲 | AlpacaUwU 羊駝屋"><meta property="og:title" content="Beauty Disp 表特爬蟲 | AlpacaUwU 羊駝屋"><meta name=subject content="表特爬蟲，圖源自 Disp 表特板"><meta name=description content="表特爬蟲，圖源自 Disp 表特板"><meta property="og:description" content="表特爬蟲，圖源自 Disp 表特板"><meta property="og:image" content="/app/beauty-disp/feature.png"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=android-chrome type=image/png sizes=192x192 href=../../android-chrome-192x192.png><link rel=android-chrome type=image/png sizes=512x512 href=../../android-chrome-512x512.png><link rel=apple-touch-icon type=image/png sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel="shortcut icon" href=../../favicon.ico type=image/x-icon><link rel=icon href=../../favicon.ico type=image/x-icon><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel=stylesheet><script async src="https://www.googletagmanager.com/gtag/js?id=G-B7KMWZNLKP"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-B7KMWZNLKP")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8417118187182876" crossorigin=anonymous></script><link rel=stylesheet href=../../framework/tocas/tocas.min.css><script src=../../framework/tocas/tocas.min.js></script><link rel=stylesheet href=../../css/vue.css><script src=../../js/sweetalert2.js></script></head><body><header><div class="ts-box is-sharp is-raised" style=position:fixed;width:100%;z-index:999999><div class="ts-content is-secondary"><div class="ts-breadcrumb is-chevroned"><a class=item href=../>Apps</a>
<a class=item href=#!>Beauty Disp 表特爬蟲</a></div></div></div><div style=height:47px></div></header><main><div id=App><div class="ts-container is-fitted"><br><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8417118187182876 data-ad-slot=5709143475 data-ad-format=fluid data-ad-layout-key=-hg-k+34-7c+7i></ins><br><div id=imagesBoard class="ts-grid [660px]-:is-1-columns [660px-1030px]:is-2-columns [1030-1200px]:is-3-columns [1200px]+:is-3-columns"><template v-for="(thePost, thePostKey) in posts.data"><template v-for="(theImage, theImageIndex) in thePost.images"><div class="ts-image is-rounded column"><div v-if="theImage.src.endsWith('.mp4')" class=ts-box><video @error="thePost.images.splice(theImageIndex, 1)" style=width:100% controls autoplay loop muted>
<source :src=theImage.src type=video/mp4>Your browser does not support the video tag.</video></div><img v-else :src=theImage.src @error="thePost.images.splice(theImageIndex, 1)"><div class="ts-mask is-top"><a class=ts-content style=color:#fff target=_blank :href="'https://disp.cc/b/'+posts.board+'/'+thePost.ti"><div class=ts-header><span class="ts-badge is-secondary is-small is-dense is-end-spaced">{{theImage.index}}</span>
{{ thePost.title }}</div><div class="ts-text is-truncated is-tiny">{{ thePost.desc }}</div></a></div></div><div v-if="theImage.index % ads.gap == 0" class="ts-image column"><div class=ts-box><div class=ts-content><div class="ts-header is-heavy">Ads by Google Adsense</div></div><div class=ts-content><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8417118187182876 data-ad-slot=5369836314 data-ad-format=auto data-full-width-responsive=true></ins></div></div></div></template></template><div v-show=posts.is.updating class=ts-image><img src=../../img/example.png style=max-width:450px><div class="ts-mask is-blurring is-centered"><div class="ts-loading is-large" style=color:#fff></div><span>正在抓取新圖...</span></div></div></div></div></div><script type=module>
    import '/js/ajax.esm.js';
    import { createApp, onMounted, reactive, nextTick, computed, watch, ref } from '/framework/vue.esm.js';
    // 
    const App = createApp({setup(){
        const proxyUrl = (url)=>{
            return `https://corsproxy.io/?${encodeURIComponent(url)}`;
            // return `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
        }
        // google adsense
        let ads = reactive({
            gap: 24,
            count: 0,
            pushedCount: 0,
            push: ()=>{
                (adsbygoogle = window.adsbygoogle || []).push({
                    
                });
            },
        });
        // auto push ads
        setInterval(() => {
            ads.count = document.querySelectorAll('#imagesBoard ins.adsbygoogle').length;
            while (ads.count > ads.pushedCount) {
                ads.push();
                ads.pushedCount++;
                console.log(`ads push ${ads.pushedCount}/${ads.count}`);
            }
        }, 1000);
        // 
        let posts = reactive({
            is: {
                updating: false,
                noMore: false,
            },
            board: 'Beauty',
            keyword: '', //'[正妹]',
            totalCount: 0,
            totalPagesCount: computed(()=>Math.ceil(posts.totalCount/posts.perPage)),
            imagesCount: 0,
            perPage: 20,
            page: 0,
            totalPool: computed(()=>{
                let len = posts.totalPagesCount > 1000 ? 1000 : posts.totalPagesCount;
                let arr = Array.from({ length: len }, (_, i) => i);
                arr = arr.filter(a=>!posts.pool.includes(a));
                return arr;
            }),
            pool: [],
            data: [],
        });
        // posts.data.push({
        //     images: [
        //         '/img/example.png',
        //         '/img/a.jpg',
        //         '/img/example.png',
        //         '/img/b.jpg',
        //         '/img/example.png',
        //         '/img/example.png',
        //         '/img/b.jpg',
        //         '/img/example.png',
        //         '/img/b.jpg',
        //         '/img/a.jpg',
        //         '/img/example.png',
        //     ]
        // })
        // 
        const getPosts = (pageNum=(Math.floor(Math.random() * posts.totalPool.length)))=>{
            if(posts.is.updating || posts.pool.includes(pageNum)){ return; }
            posts.is.updating = true;
            console.log(`get post ${pageNum}`)
            // 
            return $.ajax({
                url: proxyUrl(`https://disp.cc/api/board.php?act=tlist&bn=${posts.board}&pageNum=${pageNum}&ft=${posts.keyword}`),
                type: 'get',
                dataType: 'json',
            }).fail((xhr, status, error)=>{
                console.error(xhr);
            }).done((resp)=>{
                console.log(resp);
                posts.pool.push(pageNum);
                posts.totalCount = resp.data.totalNum;
                // 
                const parser = new DOMParser();
                resp.data.tlist.forEach(async(post, idx)=>{
                    $.ajax({
                        url: proxyUrl(`https://disp.cc/m/${posts.board}/${post.ti}`),
                        type: 'get',
                        dataType: 'html',
                        // async: false,
                    }).done((content)=>{
                        post.images = [];
                        let html = parser.parseFromString(content, 'text/html');
                        post.images = Array.from(html.querySelectorAll('head meta[property="og:image"]')).map(
                            meta => meta.getAttribute('content')
                        ).slice(0, -2).map(src => {
                            posts.imagesCount++;
                            return {
                                index: posts.imagesCount,
                                src: src,
                            }
                        });
                        posts.data.push(post);
                    });
                });
            }).always(()=>{
                if(posts.totalPool.length < 1){ posts.is.noMore = true; }
                posts.is.updating = false;
            });
        };

        onMounted(()=>{
            getPosts(-1).always(()=>{
                getPosts()
            });
            // 
            addEventListener("scroll", (e) => {
                nextTick(()=>{
                    let scrollTop = document.documentElement.scrollTop;
                    let clientHeight = document.documentElement.clientHeight;
                    let scrollHeight = document.documentElement.scrollHeight;
                    if(scrollTop+clientHeight > (scrollHeight-scrollHeight/3)){ posts.is.noMore || getPosts(); }
                });
            });
        });
        // 
        return { posts, ads, };
    }}).mount('#App');
</script></main><footer><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></footer></body></html>