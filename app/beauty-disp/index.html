<!doctype html><html lang=zh class=is-dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=content-language content="zh-tw"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta property="og:type" content="website"><meta property="og:url" content="https://uwu.alpaca.tw/app/beauty-disp/"><meta name=referrer content="no-referrer"><title>BeautyDisp 表特爬蟲 | AlpacaUwU 羊駝屋</title>
<meta name=title content="BeautyDisp 表特爬蟲 | AlpacaUwU 羊駝屋"><meta property="og:title" content="BeautyDisp 表特爬蟲 | AlpacaUwU 羊駝屋"><meta name=subject content="表特爬蟲，圖源自 Disp 表特板"><meta name=description content="表特爬蟲，圖源自 Disp 表特板"><meta property="og:description" content="表特爬蟲，圖源自 Disp 表特板"><meta property="og:image" content="/app/beauty-disp/feature.png"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel=android-chrome type=image/png sizes=192x192 href=../../android-chrome-192x192.png><link rel=android-chrome type=image/png sizes=512x512 href=../../android-chrome-512x512.png><link rel=apple-touch-icon type=image/png sizes=180x180 href=../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.png><link rel="shortcut icon" href=../../favicon.ico type=image/x-icon><link rel=icon href=../../favicon.ico type=image/x-icon><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel=stylesheet><script async src="https://www.googletagmanager.com/gtag/js?id=G-B7KMWZNLKP"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-B7KMWZNLKP")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8417118187182876" crossorigin=anonymous></script><link rel=stylesheet href=../../framework/tocas/tocas.min.css><script src=../../framework/tocas/tocas.min.js></script><link rel=stylesheet href=../../css/vue.css><script src=../../js/sweetalert2.js></script></head><body><header><div class="ts-box is-sharp is-raised" style=position:fixed;width:100%;z-index:999999><div class="ts-content is-secondary"><div class="ts-breadcrumb is-chevroned"><a class=item href=../>Apps</a>
<a class=item href=#! onclick=window.location.reload()>BeautyDisp 表特爬蟲</a></div></div></div><div style=height:47px></div></header><main><div id=App><div class="ts-container is-fitted" style=--width:1500px><div class="ts-content is-center-aligned"><div><ins class=adsbygoogle style=display:block data-ad-format=fluid data-ad-layout-key=-hg-k+34-7c+7i data-ad-client=ca-pub-8417118187182876 data-ad-slot=5709143475></ins></div><component is=script v-cloak>(adsbygoogle = window.adsbygoogle || []).push({
});</component></div><div id=imagesBoard class="masonry [660px]-:is-1-columns [660px]+:is-2-columns [1050px]+:is-3-columns [1200px]+:is-4-columns"><template v-for="(thePost, thePostIndex) in posts.data"><template v-for="(theMedia, theMediaIndex) in thePost.images"><div class="masonry-item ts-box" style=opacity:0><div v-if="theMedia.src.endsWith('.mp4')" class=ts-content><video loading=lazy @error="thePost.images.splice(theMediaIndex, 1)" style=width:100% controls autoplay loop muted>
<source :src=theMedia.src type=video/mp4>Your browser does not support the video tag.</video></div><div v-else class=ts-content><img loading=lazy :src=theMedia.src @error="thePost.images.splice(theMediaIndex, 1)" style=width:100%></div><div class="ts-mask is-top"><a class=ts-content style=color:#fff target=_blank :href="'https://disp.cc/b/'+posts.board+'/'+thePost.ti"><div class=ts-header><span class="ts-badge is-secondary is-small is-dense is-end-spaced">{{theMedia.index}}</span>
{{ thePost.title }}</div><div class="ts-text is-truncated is-tiny">{{ thePost.desc }}</div></a></div></div><div class="masonry-item ts-box" style=opacity:0><div v-if="theMedia.index % ads.gap == 0" class=ts-box><div class=ts-content><div class="ts-header is-heavy">Ads by Google Adsense</div></div><div class=ts-content><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-8417118187182876 data-ad-slot=5369836314 data-ad-format=auto data-full-width-responsive=true></ins></div><component is=script v-cloak>(adsbygoogle = window.adsbygoogle || []).push({
});</component></div></div></template></template><div v-show="posts.is.getting || masonry.is.layouting" class="masonry-item column ts-box"><img src=../../img/example.png style=width:100%><div class="ts-mask is-blurring is-centered"><div class="ts-loading is-large" style=color:#fff></div></div></div></div></div></div><style>.masonry{}.masonry.is-1-columns .masonry-item{width:100%}.masonry.is-2-columns .masonry-item{width:50%}.masonry.is-3-columns .masonry-item{width:33%}.masonry.is-4-columns .masonry-item{width:25%}</style><script type=module>
    import '/js/ajax.js';
    import '/js/masonry.js';
    import '/js/imagesLoaded.js';
    import { createApp, onMounted, reactive, nextTick, computed, watch, ref, defineComponent } from '/framework/vue.js';
    // 
    const App = createApp({setup(){
        const proxyUrl = (url)=>{
            return `https://corsproxy.io/?url=${encodeURIComponent(url)}`;
            // return `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
        }
        // google adsense
        let ads = reactive({
            gap: 24,
        });
        // 
        let posts = reactive({
            is: {
                getting: false,
                noMore: false,
            },
            board: 'Beauty',
            keyword: '', //'[正妹]',
            totalCount: 0,
            totalPagesCount: computed(()=>Math.ceil(posts.totalCount/posts.perPage)),
            imagesCount: 0,
            perPage: 20,
            page: 0,
            totalPool: computed(()=>{
                let len = posts.totalPagesCount > 1000 ? 1000 : posts.totalPagesCount;
                let arr = Array.from({ length: len }, (_, i) => posts.totalPagesCount-i);
                arr = arr.filter(a=>!posts.pool.includes(a));
                return arr;
            }),
            pool: [],
            data: [],
        });
        // 
        const getPosts = (pageNum=posts.totalPool[(Math.floor(Math.random() * posts.totalPool.length))])=>{
            if(posts.is.getting || posts.pool.includes(pageNum)){ return; }
            posts.is.getting = true;
            console.log(`get post ${pageNum}`)
            // 
            return $.ajax({
                url: proxyUrl(`https://disp.cc/api/board.php?act=tlist&bn=${posts.board}&pageNum=${pageNum}&ft=${posts.keyword}`),
                type: 'get',
                dataType: 'json',
                async: true,
            }).fail((xhr, status, error)=>{
                console.error(xhr);
            }).done((resp)=>{
                posts.pool.push(pageNum);
                posts.totalCount = resp.data.totalNum;
                // 
                const parser = new DOMParser();
                resp.data.tlist.forEach((post, idx)=>{
                    $.ajax({
                        url: proxyUrl(`https://disp.cc/m/${posts.board}/${post.ti}`),
                        type: 'get',
                        dataType: 'html',
                    }).done((content)=>{
                        post.images = [];
                        let html = parser.parseFromString(content, 'text/html');
                        post.images = Array.from(html.querySelectorAll('head meta[property="og:image"]')).map(
                            meta => meta.getAttribute('content')
                        ).slice(0, -2).map(src => {
                            posts.imagesCount++;
                            return {
                                index: posts.imagesCount,
                                src: src,
                            }
                        });
                        nextTick(()=>{
                            masonry.imagesLoaded(()=>{ posts.data.push(post); });
                        });
                    });
                });
            }).always(()=>{
                if(posts.totalPool.length < 1){ posts.is.noMore = true; }
                posts.is.getting = false;
            });
        };

        let isScrollBottom = ()=>{
            let scrollTop = document.documentElement.scrollTop;
            let clientHeight = document.documentElement.clientHeight;
            let scrollHeight = document.documentElement.scrollHeight;
            return (scrollTop+clientHeight > (scrollHeight-scrollHeight/2));
        };

        const masonry = reactive({
            obj: undefined,
            is: {
                layouting: false,
            },
            init: ()=>{
                return new Masonry(document.querySelector('.masonry'), {
                    itemSelector: '.masonry-item',
                    columnWidth: '.masonry-item',
                    percentPosition: true,
                    // gutter: 4,
                    stagger: 20,
                    initLayout: false,
                    isAnimated: true,
                    transitionDuration: '0s', //'0.2s',
                    visibleStyle: {
                        transform: "translateY(0)",
                        opacity: 1
                    },
                    hiddenStyle: {
                        transform: "translateY(100px)",
                        opacity: 0
                    }
                });
            },
            imagesLoaded: (callback)=>{ return imagesLoaded(document.querySelector('.masonry'), callback); },
            layout: ()=>{
                nextTick(() => {
                    masonry.obj.reloadItems();
                    masonry.imagesLoaded(()=>{
                        masonry.obj.layout();
                    });
                });
            }
        });

        onMounted(()=>{
            masonry.obj = masonry.init();
            masonry.obj.on('layoutComplete', (items)=>{
                items.forEach(item=>{
                    item.element.style.opacity = 1;
                });
            });
            // 
            getPosts(-1).always(()=>{
                getPosts().always(()=>{
                    setInterval(() => {
                        nextTick(()=>{
                            masonry.imagesLoaded(()=>{
                                if(isScrollBottom()){ posts.is.noMore || masonry.is.layouting || getPosts(); }
                            });
                        });
                    }, 500);
                    // let scrollChecker = setInterval(async()=>{
                    //     nextTick(()=>{
                    //         masonry.imagesLoaded(()=>{
                    //             if(isScrollBottom()){ posts.is.noMore || getPosts(); }
                    //             else{ clearInterval(scrollChecker); }
                    //         });
                    //     })
                    // }, 1000);
                })
            });
            //
            // addEventListener("scroll", (e) => {});
        });
        // 
        watch(posts.data, () => {
            masonry.is.layouting = true;
            masonry.layout();
            nextTick(()=>{
                masonry.imagesLoaded(()=>{}).on('done', ()=>{
                    masonry.is.layouting = false;
                });
            })
        });
        // 
        return { posts, ads, window, document, masonry };
    }}).mount('#App');
</script></main><footer><script></script></footer></body></html>